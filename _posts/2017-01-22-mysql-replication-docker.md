# Репликация MySQL-серверов с помощью Docker

До выхода приложения в бой, нужно смоделировать его поведение
[в тестовой среде](/2017/01/09/sandbox-for-web-developers.html).

Технология Docker Swarm позволяет легко масштабировать приложение горизонтально.
Но приложению приходится обращаться к серверу баз данных, задача масшабировать который гораздо труднее.

![Много приложений - одна база](/images/several-upstream-one-db.svg "Много приложений - одна база")

В нашем случае количество запросов на чтение информации гораздо меньше количества изменений
(есть подозрение, что так на большинстве веб-проектов).
Логичным способом увеличения такого бутылочного горлышка -
увеличить количество баз на чтение и настроить приложение таким образом,
чтобы большее количество запросов на чтение
отправлялось на SLAVE-сервера.

![Много приложений - одна база](/images/several-upstream-several-dbs.svg "Много приложений - много баз")

## Настройка репликации

### Изменение в my.cnf для каждого сервера

Каждый сервер должен иметь свой номер.
Master-сервер `server-id=1`.
Slave-сервер `server-id>1`.

Конфигурационный файл находится по адресу
`/etc/mysql/conf.d/my.cnf`

Конфигурация master-сервера
```
[mysqld]
server-id=1
binlog_format=ROW
log-bin
```

Конфигурация slave1
```
[mysqld]
server-id=2
```

Конфигурация slave2
```
[mysqld]
server-id=2
```